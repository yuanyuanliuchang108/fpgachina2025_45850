在工业物联网迅猛发展的背景下，对网络流量的高效、精确测量提出了更高
要求，尤其在流量规模庞大、实时性需求严苛的工业场景中，传统纯软件或纯
FPGA 方案在精度、速度与通用性方面面临严峻挑战。针对这一痛点，本项目融
合 Zynq 开发板 PS 端的灵活协议处理与 PL 端的高速并行计算优势，构建从“流
量注入 - 协议解析 - 硬件统计 - 结果查询”的全闭环网络流量测量系统。
本系统的核心设计思想是构建一个高度模拟真实工业环境的测量闭环。首先，
上位机基于 C++与 Libpcap 库生成自定义参数的 IPv4 流量，旨在模拟工业环境
中的海量 IPv4 网络地址的实时数据流。采集后的数据经由高速接口传输至 Zynq
的 PS 端，以供后续处理与解析。
随后，Zynq 开发板的处理子系统（PS）对数据流进行初步调度与管理，这
是系统数据处理的关键特色模块。PS 端简化 TCP/IP 协议栈，跳过以太网帧头提
取 IPv4 头部的源 IP、目的 IP 字段，并通过 AXI 总线协议将解析结果写入片上
BRAM 以实现 PS 与 PL 之间的数据通信。
然后，在 PL 端部署基于先进草图数据结构（Count-Min-Sketch）定制的高
性能流量测量硬件 IP 核，这是本项目真正的测量效能爆发点，也是本项目创新
特色的核心体现。采用概率型算法可规避精确计数在大规模 IP 场景下的内存爆
炸问题，大幅节省 BRAM 资源以适配 FPGA 有限存储，且计数误差可控，能平
衡测量精度、处理速度与硬件资源效率。该 IP 核采用 4 组“移位+XOR”硬件友好
型哈希函数将 32 位 IP 地址映射为 4 个 10 位索引，通过 4×1024 的 16 位同步计
数器阵列实现并行累加。该 IP 核以三状态机精准控制 BRAM 读流程，并统一时
钟域保障时序稳定，当接收到 PS 端查询触发信号后，经两级并行比较输出目标
IP 的近似计数结果。最后，PS 端通过 AXI 总线接收 PL 端结果，将其封装为“指
令类型、IP 地址、计数结果”格式的响应包，回传至上位机完成查询。
本项目成功模拟并验证了一整套部署于工业物联网环境下的、端到端的网络
流量测量系统。该系统不仅显著提升了流量测量的精度和速度，还具有良好的适
1
应性与通用性，为解决工业物联网复杂网络环境下的流量监控难题提供了一套切
实可行的、具备工程应用价值的硬件参考方案。